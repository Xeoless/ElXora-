<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ElXora</title>
  <link rel="stylesheet" href="style.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"/>
</head>
<body>

  <!-- ‚îÄ‚îÄ‚îÄ PROTECTION: Redirect to login if not authenticated ‚îÄ‚îÄ‚îÄ -->
  <script>
    // This runs immediately ‚Äî if no current user, go to login page
    (function() {
      const currentUser = localStorage.getItem('elxora_current_user');
      if (!currentUser) {
        window.location.replace('login.html');
      }
    })();
  </script>

  <!-- Main App (everything below this line stays exactly as you had it) -->
  <div id="app-container" class="app-container">
    <aside id="sidebar" class="sidebar">
      <button id="new-chat-btn">+ New Chat</button>
      <div id="chat-list" class="chat-list"></div>
      <div id="user-info" class="user-info">
        <div class="avatar" id="avatar"></div>
        <div class="user-details">
          <strong id="username-display"></strong>
          <small id="email-display"></small>
        </div>
      </div>
      <!-- Add logout button here -->
      <button id="logout-btn" style="margin:16px; padding:12px; background:#e11d48; color:white; border:none; border-radius:8px; cursor:pointer;">
        Log Out
      </button>
      <button id="sidebar-toggle" class="sidebar-toggle">‚Üê</button>
    </aside>

    <main id="main-chat" class="main-chat">
      <header>
        <button id="mobile-sidebar-toggle" class="mobile-sidebar-toggle">‚ò∞</button>
        <div class="chat-header-title">
          <h2 id="chat-title">New Chat</h2>
          <small class="subtitle">Powered by Gemini ‚Ä¢ ElXora</small>
        </div>
        <button id="settings-btn" class="settings-btn">‚öô</button>
      </header>

      <div id="chat-messages" class="chat-messages"></div>
      <div id="typing-indicator" class="typing-indicator hidden">
        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
      </div>

      <div class="input-area">
        <div class="input-wrapper">
          <button id="attach-btn" class="attach-btn" title="Attach file">üìé</button>
          <textarea id="message-input" rows="1" placeholder="Message ElXora..." aria-label="Type your message"></textarea>
          <button id="send-btn" class="send-btn" title="Send" disabled>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <line x1="12" y1="19" x2="12" y2="5"></line>
              <polyline points="5 12 12 5 19 12"></polyline>
            </svg>
          </button>
        </div>
        <input type="file" id="file-input" hidden/>
      </div>
    </main>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal hidden">
    <div class="modal-content">
      <h2>Settings</h2>
      <label>Gemini API Key</label>
      <input type="text" id="api-key" placeholder="AIzaSy..."/>
      <button id="save-api-key">Save</button>
      <button id="close-settings">Close</button>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast hidden"></div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
  <script src="script.js"></script>

  <!-- Logout handler (add this small block or put it in script.js) -->
  <script>
    document.getElementById('logout-btn').addEventListener('click', () => {
      localStorage.removeItem('elxora_current_user');
      window.location.href = 'login.html';
    });
  </script>
</body>
</html>
